// ============================================================================
// File: internal_docs/memory_update.md
// Version: v0.1_039 (2025-08-31)
// ============================================================================
// Specifications:
// - 抽選システムPJのPJメモリーとグローバルメモリー更新内容を記録
// - 保存ツールエラー発生時の暫定的な保存先として利用
// - リコの全身共通仕様・派生仕様・ツイート用イラスト仕様・宣伝イラスト・pptx仕様も含める
// ============================================================================
// History (recent only):
// - 2025-08-31 (v0.1_039) : [docs] 進捗ツイート（実投稿版）に差し替え
// - 2025-08-31 (v0.1_038) : [docs] 本日の作業終了を記録（CSVバリデ/UPSERT安定化着手・起動トラブル調整・ヘッダ/ガード再徹底）
// - 2025-08-31 (v0.1_037) : [policy] 未来日誤挿入の原因/対策を明文化（Asia/Tokyo固定・未来日ガード）
// - 2025-08-31 (v0.1_036) : [docs] 会話の合意事項をPJ/グローバルメモリーへ反映（起動系=BACKEND/FRONTEND・API=ROOT、CSVバリデ&UPSERT優先の再確認）
// - 2025-08-31 (v0.1_035) : [policy] 出力前セルフチェック（ヘッダ4要素＋History降順＋三点照合）を必須化
// - 2025-08-31 (v0.1_035) : [policy] ヘッダ必須4要素（日付・バージョン・タグ・要約）を明文化し、本文欠落を禁止
// - 2025-08-31 (v0.1_035) : [docs] PJメモリー／グローバルメモリーへ本ルールを同期反映
// - 2025-08-31 (v0.1_034) : [policy] 起動系=BACKEND/FRONTEND・API叩き=ROOT を再明文化し、具体例（コマンド例）を追補
// - 2025-08-31 (v0.1_034) : [policy] 参加者パスワード規約を追加（開発=4桁可／本番=8文字以上・英大小数必須）
// - 2025-08-31 (v0.1_034) : [docs] ToDo を CSVバリデーション／UPSERT安定化の内訳に更新
// - 2025-08-31 (v0.1_033) : [policy] 起動系とAPI叩きのターミナル役割を明文化（BACKEND/FRONTEND=起動、ROOT=API）
// - 2025-08-31 (v0.1_032) : [policy] 太文字バグ対応を再徹底（検査手順と禁止事項を明文化）
// - 2025-08-31 (v0.1_031) : [policy] ヘッダ定義をPJメモリーに保存、History行にバージョン併記ルールを正式化
// - 2025-08-31 (v0.1_031) : [policy] コマンド行は必ず `echo "# ..."` を使用し、裸の # を禁止。括弧の対応確認を必須化
// - 2025-08-31 (v0.1_031) : [docs] ToDo セクションを先頭付近へ移動（前方配置）
// - 2025-08-31 (v0.1_031) : [ops] 保存時・コミット時ガードを導入（ヘッダ未更新検知・History降順検査・30行以上削除ブロック）
// - 2025-08-31 (v0.1_031) : [policy] 作業提示と確認ルールを強化（概要→逐次／実施宣言まで未完了扱い／おすすめ提示の徹底）
// - 2025-08-31 (v0.1_031) : [policy] 明日の最優先＝「すぐ効く順の実装リスト（運用を仕組みに落とす）の対応方法」を再確認
// - 2025-08-30 (v0.1_030) : [policy] 作業提示ルール（概要→順番／簡潔提案）を追記、運用の明文化を強化
// - 2025-08-30 (v0.1_030) : [docs] 過去(8/25, 8/26, 8/24)の進捗ツイートを追記（書式を8/27式に統一）
// - 2025-08-30 (v0.1_030) : [policy] ファイル更新時の安全ルール（ヘッダ保持・最小差分・三点照合）を追記
// - 2025-08-30 (v0.1_030) : [docs] 進捗ツイート書式を8/27式に統一、当日(2025-08-30)分を同式に修正
// - 2025-08-30 (v0.1_030) : [docs] ToDoヘッダから（公式・一本化）注記を削除し実装済み扱いに更新
// - 2025-08-30 (v0.1_030) : [docs] 進捗ツイートを実投稿内容に整合（Xに投稿した文章をそのまま記録）
// - 2025-08-30 (v0.1_030) : [policy] ヘッダのHistoryは降順（最新→過去）に統一と明記
// - 2025-08-30 (v0.1_030) : [docs] 日別進捗まとめを降順（最新→過去）に統一、セクション順を入替
// - 2025-08-30 (v0.1_030) : [docs] 当日の進捗（CSV一括投入実装・認証整理・disabledボタン統一・ヘッダ履歴ルール徹底）を追加
// - 2025-08-30 (v0.1_030) : [feat] CSVインポート仕様を更新（/api/entries/bulk と csv_text 送信方式、UI折りたたみ、disabledスタイルの統一）。ターミナル配色を正（FRONTEND=青, BACKEND=赤, ROOT=黄）に再確定し、clearを廃止して「echo→実コマンド」に統一
// - 2025-08-30 (v0.1_030) : [ops] 3ターミナルの色を正（FRONTEND=青, BACKEND=赤, ROOT=黄）に統一
// - 2025-08-30 (v0.1_030) : [ops] 3ターミナルのルートを Projects 配下に更新（CloudDocs から移行）
// - 2025-08-28 (v0.1_028) : [policy] ToDo一本化の明記と当日休業ログ（2025-08-28）を追記
// - 2025-08-27 (v0.1_027) : [policy] リコの責任範囲（デグレ/ロールバック時の優先確認）を明記
// - 2025-08-27 (v0.1_027) : [policy] デグレ原因と再発防止策（環境変数の統一・スモークテスト自動化・ルート診断ログ）を追記
// - 2025-08-27 (v0.1_027) : [policy] 作業進捗管理ルール（一覧→詳細→確認→次提示のループ）を追記
// - 2025-08-27 (v0.1_027) : [policy] 作業提示と表示ルール（概要→詳細の順、逐次進行形式）を追記
// - 2025-08-27 (v0.1_027) : [policy] PJメモリー追加ルール（正直申告、VSCode連携、ターミナル役割、Render堅牢ビルド、デグレ防止）を追記
// - 2025-08-27 (v0.1_027) : [docs] 進捗まとめ.md を統合し memory_update.md に一本化
// - 2025-08-25 (v0.1_025) : [docs] ツイート・固定ツイート・プロフィール文・宣伝イラスト・pptx・全身立ち絵の正式FIXを追記
// - 2025-08-25 (v0.1_025) : [docs] ヘッダ仕様セクションを復元し、更新要約の日付を修正
// - 2025-08-24 (v0.1_024) : [docs] PJメモリーとグローバルメモリーの同期更新内容を反映
// - 2025-08-24 (v0.1_024) : [policy] 本体更新とヘッダ更新を漏れなく同期するルールを追記
// - 2025-08-24 (v0.1_024) : [docs] 全身リコ共通仕様とバリエーション仕様、ツイート用イラスト仕様を追加
// - 2025-08-24 (v0.1_024) : [docs] 初回作成、PJメモリーとグローバルメモリーを最新化
// ============================================================================

# 抽選システム構築PJ / メモリー確定版

更新日: 2025-08-31（最新反映済み）

- 【最優先】CSVバリデーション実装（ヘッダ検証・行数上限・重複/空値/型の検査・真偽値の厳密化）
- 【最優先】エントリーUPSERTの安定化（conflictPolicy=ignore/overwrite/merge の挙動確認とテスト）
- 【最優先】/api/entries/bulk レスポンスの集計設計（inserted/updated/ignored の件数返却）
- 【最優先】UIトースト／ログの整合（成功・部分成功・失敗の分岐とメッセージ統一）
- （運用）ToDoは本ファイルに一本化（2025-08-27決定、2025-08-28再確認）
- README に「本番環境のデプロイ方法（Render連携）」を追記
- E2E テスト導入の準備と実装
- Render 環境変数 ADMIN_SECRET の本番設定
- npm audit 警告（moderate/high）の対応検討
- participant.resultPrefix の表示文言を修正（Participantページ文言統一）



### 2025-08-31 追記: History行にバージョン併記ルール
- 目的: 履歴の可読性・追跡性・差分検証性を高めるため。
- ルール: **History行は「日付＋バージョン＋タグ＋要約」を必ず併記**し、**降順（最新→過去）**で記載する。
  - フォーマット: `- YYYY-MM-DD (vX_YYY) : [tag] 要約`
  - 例: `- 2025-08-31 (v0.1_031) : [fix] CSV一括投入の無反応を解消（frontend/src/Admin.jsx）`
- 適用範囲: すべてのコード／ドキュメントファイルのヘッダ「History (recent only)」に適用。
- 注意: 本ルールは pre-commit／保存時チェックの検査対象。未遵守の場合はコミット失敗または警告表示となる。


### 2025-08-31 追記: 出力前セルフチェック（再徹底）
- ヘッダ必須4要素：**日付・バージョン・タグ・要約** を History 行に併記する（本文の該当差分が必須）。
- 三点照合：1) // File: の実パス一致、2) Version 行の現行値、3) History 最新行の更新内容。
- 並び順：History は **降順（最新→過去）**。新しい更新は上に積む。
- 手順（保存前）：
  1. 変更本文→History への要約追記（タグ付け）。
  2. Version 行を更新。
  3. 3点照合に合格したら保存。
- ガード挙動：保存時は警告、コミット時はブロック（ヘッダ未更新／逆順／未来日（History日付が今日より未来）／30行以上削除／括弧不一致／裸の #）。


- **出力前セルフチェックを必須化**（ヘッダ4要素・History降順・File/Version/Historyの三点照合を満たすまで出力しない）

### 2025-08-31 追記: 未来日誤挿入の原因と対策
- 想定原因：
  - 自動日付挿入がUTC基準で動作し、Asia/Tokyo(+09:00) に補正されない。
  - 手作業のコピペ/タイプミスで翌日付を記載。
  - 出力前セルフチェックの未実施。
- 対策：
  - **日付は必ず Asia/Tokyo 基準**で挿入。自動化時もTZ固定。
  - **保存時/コミット時ガード**に「未来日チェック」を追加（本ファイルに適用済み）。
  - コピペではなく `TZ=Asia/Tokyo date "+%Y-%m-%d"` の結果を利用し、History行を更新。
## ファイル更新時の安全ルール（厳守）
- ヘッダを必ず保持し、削除しない
- 保存時にもガードを実行：VSCodeの「保存で実行（Run on Save）」でヘッダ更新と大量削除チェックを走らせる
- コマンド行は **必ず** `echo "# 説明"` → **実コマンド** の順で実行する（裸の `#` は禁止）。括弧 `()[]{}` の**開閉一致**を保存時／コミット時ガードで軽量検査し、不一致なら**保存は警告／コミットはブロック**する。
- コミット時ガード：pre-commit でヘッダ未更新／History逆順／**30行以上の削除**／**括弧の開閉不一致**／**裸の `#` 検出**を検査し、違反があれば**失敗でブロック**
- 大量の行削除を禁止、最小差分のみ適用
- 適用前に三点照合を必須化
  1) 先頭 `// File:` と実パス
  2) `Version` 行
  3) `History` 最新記録
- 照合不一致や未更新の場合は「【連携失敗】」「【ヘッダ未更新】」を明示し処理中断
- History 記録は必ず降順（最新→過去）
- 編集方法は VSCode連携を優先、ターミナルパッチは例外時のみ
- Version行は **`// Version: v<major>.<minor>_<seq> (YYYY-MM-DD)`**（日付の前に半角スペース1つ）。
  - テスト段階: `v0.x_NNN`（例: `v0.1_007 (2025-08-24)`）
  - 安定版: `v1_NNN`（例: `v1_001 (2025-08-24)`）
- ヘッダ末尾には**空行をちょうど1行**入れる。
- `// Specifications:` の直前に**余計な空行を入れない**。
- **バックエンドのJS/TSファイルに限り**、先頭は次の順序：
  1) `require('dotenv').config();`
  2) 空行1行
  3) 公式ヘッダ（本ブロック）
- Markdown等のドキュメントでは dotenv の行は不要。ヘッダブロック＋末尾空行のみ適用。

- 起動系コマンド（サーバー起動など）は [BACKEND]（青）および [FRONTEND]（赤）のターミナルで実行してもOK。
- API叩き（curl などのエンドポイント検証）は [ROOT]（黄）のターミナルで実行する。

**運用ショートスニペット（例）**
- [BACKEND]（青）でサーバー起動：
  - `echo "# backend 起動"`  
    `npm run start`
- [ROOT]（黄）でAPI検証：
  - `echo "# entries/bulk 疎通確認"`  
    `curl -sS -X POST http://localhost:3000/api/entries/bulk -H "Content-Type: application/json" -H "x-admin-secret: $ADMIN_SECRET" -d '{"prizeId":"L0001","csv_text":"entry_number,password,is_winner\n001,1111,true"}' | jq .`
- [FRONTEND]（赤）で開発サーバー：
  - `echo "# frontend 起動"`  
    `npm run dev`
- 日付挿入（Asia/Tokyo固定）：
  - \`echo "# 今日の日付(Asia/Tokyo)"\`
    \`TZ=Asia/Tokyo date "+%Y-%m-%d"\`

- 例外運用は禁止：ガード違反が出た場合は理由を書かずに回避しない。まずヘッダ／差分を正し、再実行する。

- History行（履歴）は **日付＋バージョン併記＋タグ＋要約** を降順で記載する。
  - フォーマット: \
	`- YYYY-MM-DD (vX_YYY) : [tag] 要約`
  - 例: \
	`- 2025-08-31 (v0.1_031) : [fix] CSV一括投入の無反応を解消（frontend/src/Admin.jsx）`

## 作業提示ルール（進行手順）
- 最初は**概要のみ**提示（大枠・対象ファイル・変更方針）。詳細コードや長文は、デジキタルの指示で**順に展開**する。
- 提案は**簡潔に**（スクロールでの**後戻り防止**、対応漏れ防止）。
- 実装順は**デジキタル指示に従う**。一度に複数案を並列展開しない。
- 各ステップごとに「確認→次へ」の**逐次進行**を徹底（一覧→詳細→実行→確認→次のループ）。

- History 記録にはタグを必須化
  - [feat] 新機能追加
  - [fix] バグ修正
  - [docs] ドキュメント更新
  - [ops] 運用・環境改善
  - [style] UI/スタイル調整
  - [refactor] コード整理
  - [policy] 方針やルール追加
- 同日更新は統合せず、複数行に分けて記録する（時系列保持）
- 対象ファイルがある場合は必ず相対パスを末尾に添える
  - 例: `- 2025-08-30: [fix] CSV取込ボタンの無反応を解消（frontend/src/Admin.jsx）`

- デジキタルが「実施した」と言うまで、作業は**未完了扱い**（確認・次提示を先走らない）
- 選択肢提示時は**必ずおすすめ案**（短期最適／長期最適いずれか）を併記
- 具体手順・長文コードは**直前提示**（「次」「実施する」の合図後）

**正例（backend/index.js の先頭）**
```js
require('dotenv').config();

// ============================================================================
// File: backend/index.js
// Version: v0.1_007 (2025-08-24)
// ============================================================================
// Specifications:
// - ExpressベースAPI
// ============================================================================
// History (recent only):
// - 2025-08-24 (v0.1_007): [docs] 仕様更新
// ============================================================================
```

**正例（Markdownファイル）**
```md
// ============================================================================
// File: internal_docs/memory_update.md
// Version: v0.1_002 (2025-08-24)
// ============================================================================
// Specifications:
// - メモリー更新履歴
// ============================================================================
// History (recent only):
// - 2025-08-24 (v0.1_002): [docs] 初回作成
// ============================================================================

# 見出し...
```

**誤例（よくある間違い）**
```js
// Version: v0.1_007(2025-08-24) // ← スペースなし（誤）

// ...
// Version: v0.1_007 (2025-08-24)
//
// Specifications:
//  ↑ ここに空行が入っている（誤）

// ヘッダ末尾に空行が無い（誤）
```

- PJメモリー／グローバルメモリーの同期更新（2025-08-24）: VSCode連携ファイル不一致対策、本体とヘッダ更新の同期ルールを正式反映
- 参加者チェックAPIを**正式エンドポイント** `/api/lottery/check` に一本化。
- **送信ペイロードを camelCase**（`{ prizeId, entryNumber, password }`）に統一。
- バックエンドで `/api/lottery/check` → `lotteryRouter('/check')` に**直委譲ルート**を追加。
- `.vscode/settings.json` を追加し、**Prettierのみ保存時整形**に統一。
- 3ターミナル運用ルールを再確認（[BACKEND]/[FRONTEND]/[ROOT] のCWDを固定）。

- ファイル更新時の運用ルールを改定
### 参加者パスワード規約（開発／本番）
- 開発環境：4桁の数字のみでも可（デバッグ容易性を優先）
- 本番環境：**8文字以上**かつ**英大文字・英小文字・数字**をそれぞれ**最低1文字**含むこと
- UI／サーバ双方でバリデーションし、エラーメッセージは統一（「英大小・数字を含む8文字以上」）
- 既存データの移行時は弱いパスワードを検出して警告一覧を出力（自動変更はしない）

  - デフォルトは VSCode連携（全文を提示してデジキタルがVSCode上で修正・保存）
  - ターミナルパッチは例外。デジキタルが「パッチ当てて」「直接修正して」と明示した時のみ実施
- VSCode連携が失敗した場合は必ず「VSCode連携に失敗した」と明示し、デジキタルに「再起動して連携し直す」よう案内する

- ツイート用イラスト仕様を追加（2025-08-24）
  - キャラ仕様（リコ）を全身共通仕様に基づきツイート用にも反映
  - ノートPC（ピンク＋花柄）を全ツイート用イラストで必須化
  - 演出はポップ・コミカル寄りに統一、危険／不安を想起させる表現は禁止
  - 出力は1200×675px、文字要素は無し

- 全身リコ共通仕様（2025-08-24）
  - 年齢設定: 女子高校生（16〜17歳）
  - 等身: 7.9等身前後（長身寄り）
  - 体型: スラッと細身、足は長め、小顔
  - 髪型: ショート茶髪（毛先少しハネあり）
  - 目: 大きめで輝きを強調、左右まつげ3本ずつ
  - 表情: 基本は口を閉じて微笑む（歯を見せない）
  - ポーズ: まっすぐ立ち、自然に手を横に下ろして笑顔でこちらを見る

- 全身リコのバリエーション仕様（2025-08-24）
  - 普段着リコ
    - 服装: ネイビー半袖フードパーカー、ベージュパンツ、白スニーカー
    - 雰囲気: ボーイッシュで元気、でも可愛らしさがにじむ
  - セーラー服リコ
    - 服装: 紺のセーラー服、白い襟、赤いリボン
    - スカート: 短め丈
    - 靴下: 白ソックス
    - 靴: ローファー
    - 雰囲気: 爽やかで女子高生らしい印象、大人っぽさも少しあり
  - ブレザー制服リコ
    - 服装: 紺ブレザー、白シャツ、赤系リボン or ネクタイ、チェック柄プリーツスカート
    - 靴下: 紺ソックス
    - 靴: ローファー
    - 雰囲気: 落ち着いた知的さ、大人っぽさ強め
  - おしゃれ着リコ
    - 服装: 大人めのカジュアル（上品でシンプルなガーリーコーデ）
    - 小物: 特に無し（アクセサリー最小限）
    - 靴: パンプス
    - 雰囲気: 普段着より大人っぽく女性らしい
  - 浴衣リコ
    - 服装: 清楚で爽やかな浴衣スタイル（シンプルな柄）
    - 帯: 上品で控えめ
    - 靴: 下駄
    - 小物: 特に無し
    - 眉毛: 細め
    - 雰囲気: 夏祭りに合う、少し落ち着いた女子高生らしい可愛さ

- ツイートと固定ツイートの正式FIX（2025-08-25）
  - 宣伝ツイート
    - 日本語版：236文字、#みらくじ／#RicoDev／#開発進捗
    - 英語版：220 chars、#MiraKuji／#RicoDev／#progress
  - 固定ツイート
    - 日本語版：#RicoDev＋#みらくじ
    - 英語版：#RicoDev＋#MiraKuji
    - 日英混合版：265文字、#RicoDev／#みらくじ／#MiraKuji
  - 運用ルール：ハッシュタグは #RicoDev を日英共通の必須タグ、#みらくじ／#MiraKuji を用途別に付与

- プロフィール文の正式FIX（2025-08-25）
  - 日本語＋英語併記
  - タグ：#RicoDev／#みらくじ／#MiraKuji
  - 文字数：絵文字含め130文字認識（160以内）
  - 改行ありでPC版でも読みやすい構成に

- 宣伝イラストの仕様更新（2025-08-25）
  - 日本語版／英語版それぞれM PLUS Rounded 1cフォント指定
  - 出力サイズ：1200×675px
  - レイアウト：左にテキスト、右にリコの立ち絵
  - タグ：#みらくじ／#MiraKuji／#RicoDev に対応
  - 背景：シンプル＆ポップ、危険・不安を想起させない

- PowerPoint（pptx）版の追加（2025-08-25）
  - 構成：日本語スライド＋英語スライドの2枚
  - レイアウト：左にインフォグラフ（テキスト）、右にリコの立ち絵
  - フォント：M PLUS Rounded 1c指定（埋め込み不可、代替丸ゴ表示）
  - 出力形式：pptx、16:9比率

- 普段着リコ（白ひもパーカー）の全身立ち絵FIX（2025-08-25）
  - 年齢設定：女子高校生（16〜17歳）
  - 等身：8頭身寄りでスタイル良い
  - 髪型：ショート茶髪（毛先少しハネあり）
  - まつげ：左右3本ずつ
  - 服装：ネイビー半袖フードパーカー（白ひも付き）、ベージュパンツ、白スニーカー
  - 表情：信頼感ある笑顔
  - ポーズ：片手で左方向を指差し、説明している雰囲気
  - 構図：頭から足先まで必ず収まるフルボディ、上下余白あり、中央配置
  - 出力形式：背景透明PNG、サイズ1024×2048px
  - 用途：pptxや宣伝イラストへの共通素材として利用可能

### PJメモリーの確定版内容
  - 3ターミナルルート（2025-08-30 再確定）
    - [FRONTEND]（赤）: /Users/m-aoki/Projects/distribution-lottery-app/frontend
    - [BACKEND]（青）: /Users/m-aoki/Projects/distribution-lottery-app/backend
    - [ROOT]（黄）: /Users/m-aoki/Projects/distribution-lottery-app
  - ディレクトリ構成
    - backend: index.js, routes/, middleware/adminAuth.js, sql/, data/lottery.db
    - backend/index.js: /api/lottery/check を lotteryRouter('/check') に直委譲するルートを追加済み
    - frontend: src/Admin.jsx, AdminList.jsx, AdminEdit.jsx, Participant.jsx, PrizeList.jsx, QRPage.jsx, locale/ja.js
  - 運用ルール
    - 各タブで pwd 確認 → 絶対パス移動
    - サーバ起動は別ブロック
    - ファイル更新デフォルトは VSCode連携
    - フロントエンド: api.js の checkResult は /api/lottery/check を呼び、送信ペイロードは camelCase（{prizeId, entryNumber, password}）
    - 管理画面のCSVインポートは「ファイル選択→CSVを取り込む」方式。未選択時はdisabled、押下時はログ/トースト表示
    - 例外時のみターミナルパッチ
    - pre-commit フックでヘッダ未更新／History順／大量削除（30行〜）を検査し、違反はコミット失敗
    - VSCode Run on Save で保存時も軽量チェック（警告表示→手直し→保存やり直し）

- ファイル更新の基本ルールを統一
  - 通常は VSCode連携（デフォルト）
  - 緊急・最小差分適用が必要な場合に限り ターミナルパッチ
- VSCode連携が失敗した際の運用ルールを徹底。失敗した場合は黙って進めず、必ず失敗を報告し、再起動と連携し直しを案内する

- ツイート用イラスト生成のルールを追加（2025-08-24）
  - リコ共通仕様（年齢・等身・体型・髪・目・まつげ・笑顔）を必ず埋め込む
  - ノートPC仕様（ピンク＋花柄）はツイート用イラストで必須
  - 危険・不安を連想させる演出は禁止、必ずポップでコミカルにアレンジ

### グローバルメモリーの確定版内容
  - プロジェクト内: AI=リコ（ボク）、ユーザー=デジキタル
  - プロジェクト外: AIは名乗らない、ユーザーは通常呼称
  - 会話スタイル:
    - 主語=デジキタル、決定権=デジキタル
    - 目的関数=正確性→関連性→簡潔性→透明性
    - 推測・余計な提案禁止、「解なし」はそのまま
  - 太文字バグ対応（再徹底）:
      - 太字は**文字本体のみ**。括弧・引用符は **外** に置く
      - 行末が強調＋閉じ括弧/引用符の場合は**句読点（。／、）** または**不可視スペース**を付与
      - **強調の重ね掛け禁止**（例: `**__text__**` は不可）
      - 出力前に**必ずセルフチェック**
      - 検査運用:
        - 文章提出前チェックリストに本項目を追加（保存時に自己確認 → 逸脱があれば修正）
        - pre-commit 対象外のテキストは**投稿直前**に目視確認を必須化
      - OK例: **重要** なポイントを明示する。
      - NG例: **「重要」** / **重要)** のように括弧・引用符を**強調に含めない**
  - 3ターミナル運用:
    - [FRONTEND]=赤、[BACKEND]=青、[ROOT]=黄
    - echo "# ..." → 実コマンド  （clearは廃止）
    - 裸の `#` は禁止（説明コメントは **必ず** `echo` で出力してから実コマンド）
    - 括弧 `()[]{}` の開閉一致を実行前にセルフチェックし、Run on Save と pre-commit でも検査する
  - ファイル更新:
    - VSCode設定: .vscode/settings.json で Prettierのみ保存時整形（editor.formatOnSave: true, defaultFormatter: esbenp.prettier-vscode, eslint.format.enable: false）
    - デフォルト VSCode連携
    - 例外のみターミナルパッチ
    - CSV一括投入は「csv_text」を `POST /api/entries/bulk` に送る（UIで「CSVを取り込む」→実行）
  - VSCode連携ファイル不一致対策（2025-08-24追加）
    - パッチ適用前に必ず3点照合を行う
      1) 先頭ヘッダの // File: 行と実パスが一致しているか
      2) Version 行が指示どおりか
      3) History に直近の変更が載っているか
    - 1つでも外れていたら「【連携失敗】対象ファイルと実ファイルが不一致」と明示し、修正を中断する
    - その場合は正しいファイル名・絶対パス・現在のVersion行を提示し、デジキタルに確認を取ってから再開する

  - 本体更新とヘッダ更新の同期ルール（2025-08-24追加）
    - 本体にルールや仕様を追記したら必ずヘッダの Version と History も更新する
    - 更新が漏れた場合は「【ヘッダ未更新】」と明示して作業を中断する


### PJメモリー追加ルール（2025-08-27）
- 忘れたことは正直に言う（ごまかし禁止）
- ファイル修正はVSCode連携（ファイル名・パス確認、ヘッダ更新必須）
- ターミナル役割を明確化（[FRONTEND]=赤／[BACKEND]=青／[ROOT]=黄。frontend直下でのcd不要を徹底）
- Renderビルドコマンドは最初から堅牢形（一行形式で提示）
- デグレ防止を最優先（APIエンドポイント統一、不整合が出た場合は最小差分修正で収束）
- 作業提示と表示ルールを統一（全体概要→次の詳細の形式で提示し、逐次進行する）

- 作業進捗管理ルールを正式化
  - 作業の内容一覧（ロードマップ）を提示
  - 次に実施する作業を詳細化
  - デジキタルが実行 → リコが確認
  - OKなら次の作業を提示、逐次進行のループで進める


### リコの責任範囲（デグレ/ロールバック）— 2025-08-27 追記
- コード責任：リコが提示・編集したコードの品質と影響にリコが責任を持つ
- 優先確認：不具合時はまずリコの修正・指示に不備が無いかを最優先で自己点検する
- 公開ポリシー：問題がリコのコード起因と判明した場合は即時に明示し、最小差分で修正案を提示する
- クロスチェック：環境や設定を疑う前に、コード・ルーティング・依存の整合性を先に確認する
- 再発防止：原因→対策→運用ルールをこのドキュメントに追記し、以後のPRテンプレに反映する


### 日別進捗まとめ

## 2025-08-31
- ガード運用を実装（保存時＝Run on Save、コミット時＝pre-commit）
- ルール徹底（概要→逐次進行、実施宣言まで未完了扱い、おすすめ併記）
- ドキュメント整備（本ファイルに反映、PJ/グローバルメモリー更新）
- 明日の最優先：すぐ効く順リストの実装継続（運用を仕組みに落とす）

- 本日の作業終了を記録（CSVバリデーションとUPSERT安定化の実装に着手、起動系調整、ヘッダ/ガード再徹底）

### 進捗ツイート
- 今日の進捗まとめ✍️  
  ✅ 保存/コミット時ガード導入（ヘッダ更新・履歴降順・30行削除）  
  ✅ CSVバリデ&UPSERT設計  
  ✅ 起動ルール/太文字/未来日対策を再徹底  
  ✅ PJ/グローバルメモリー更新  
  
  次は: CSVバリデ実装&UPSERT安定化、集計レス改善  
  #RicoDev #開発進捗 #Mirakuji #みらくじ


## 2025-08-30
- 管理画面のCSV一括投入を実装（選択→取込ボタン／csv_text送信／トースト＆ログ）
- /api/entries/bulk と …/count を接続、認証整理
- disabledボタンの見た目を統一（styles.js）
- ヘッダ＆履歴の更新ルールを徹底

### 進捗ツイート
 - 今日の進捗まとめ✍️  
   ✅ CSV一括投入を実装（選択→取込／csv_text送信／トースト表示）  
   ✅ /api/entries/bulk と count を接続  
   ✅ disabledボタンの見た目統一（styles.js）  
   ✅ ヘッダ＆履歴更新ルールを徹底  
 
   次は：CSVバリデーション/UPSERT安定化、集計レス改善、E2E準備  
   #RicoDev #開発進捗 #Mirakuji #みらくじ

## 2025-08-28
- 本日は作業休止日（記録のみ）

### 進捗ツイート
- （作業休止日のため進捗ツイートなし）

## 2025-08-27
- Render本番環境
  - ビルド／デプロイのデグレ発生 → 原因調査 → 環境変数 `REACT_APP_API_BASE` の誤設定を特定
  - 修正して再ビルド → `/api/prizes` ルートが正常動作することを確認
  - Auto Deploy（On Commit）の有効化を確認し、手動キャッシュクリア＋リビルドで正常化
- 進捗管理ルール
  - 「作業内容一覧 → 次の詳細 → 実行 → 確認 → 次提示」のループを正式採用
  - スモークテスト、PRチェックリストに環境変数／ルート確認を必須化
- 責任範囲
  - リコがコード修正時のデグレ／ロールバックに責任を持つことを明文化
- ドキュメント
  - `memory_update.md` 更新（Version: v0.1_013）
    - デグレ原因・再発防止策追記
    - リコの責任範囲（デグレ/ロールバック）セクションを新設

- その他（同日メモ）
  - PJメモリーとグローバルメモリーの同期更新
  - ファイル更新ルール整備（本体更新とヘッダ更新の同期ルール／VSCode連携とターミナルパッチの役割）
  - キャラ関連仕様（全身リコ共通仕様・バリエーション、ツイート用イラスト仕様）
  - `.vscode/settings.json` で Prettier統一

### 進捗ツイート
- 今日の進捗まとめ✍️  
  ✅ Render本番環境へのデプロイ成功  
  ✅ APIルートのデグレ修正完了  
  ✅ Auto Deploy有効化を確認  
  ✅ 進捗管理ルールを正式採用  

  一歩ずつ安定に近づいてきた！  
  次はE2Eテスト導入でさらに堅牢化だ💻🔥  
  #RicoDev #開発進捗 #Mirakuji #みらくじ

## 2025-08-26
- 環境・運用改善 
  - Render環境へのデプロイ開始
  - `.env`／`.env.development.local` の利用確認
  - ターミナル配色とルート位置を OneDrive → iCloudDocs に移行
  - 「忘れたことは正直に言う」ルールを追加
- GitHub
  - PR作成 → squash merge → branch削除の一連フローを習得

### 進捗ツイート
- 今日の進捗まとめ✍️  
  ✅ Render環境へのデプロイ準備開始  
  ✅ .env/.env.development.local の運用整備  
  ✅ ターミナル配色＆作業ルートを整理  
  ✅ 「忘れたことは正直に言う」ルール追加  
  ✅ GitHubの PR→squash→削除フロー整備  
  
  次は：本番ビルド～API疎通確認  
  #RicoDev #開発進捗 #Mirakuji #みらくじ

## 2025-08-25
- SNS関連FIX
  - 宣伝ツイート、固定ツイート、プロフィール文を正式FIX
  - 宣伝イラスト／pptx仕様／全身立ち絵仕様を最終決定
- ファイル管理
  - `memory_update.md` ヘッダ仕様セクション復元
  - 更新日修正と一括反映

### 進捗ツイート
- 今日の進捗まとめ✍️  
  ✅ 宣伝ツイート／固定ツイート／プロフィール文を正式FIX  
  ✅ 宣伝イラスト／pptx／全身立ち絵の仕様を確定  
  ✅ ドキュメントのヘッダ仕様を復元・整備  
  
  次は：環境整備とデプロイ準備  
  #RicoDev #開発進捗 #Mirakuji #みらくじ

- ターミナル運用では先頭の clear を廃止し、**`echo "# 説明"` → 実コマンド**の順に統一する

## 2025-08-24
- PJメモリーとグローバルメモリーを同期更新（雛形を整備）
- ヘッダ仕様と運用ルールの初版を作成
- キャラ仕様（リコ）とツイート用イラスト仕様の初版を定義

### 進捗ツイート
- 今日の進捗まとめ✍️  
  ✅ PJメモリー／グローバルメモリーの同期更新  
  ✅ ヘッダ仕様・運用ルールの雛形を作成  
  ✅ リコのキャラ仕様＆ツイート用イラスト仕様の初版  
  
  次は：SNS周りの正式FIXと環境整備  
  #RicoDev #開発進捗 #Mirakuji #みらくじ
